{% extends 'base.html' %}

{% block sidebar_widgets %}
<div class="widget">
    <h3>Top Sotuvlar</h3>
    {% for item in sidebar_best_sellers %}
    <div class="mini-product">
        <img src="{% if item.image %}{{ item.image.url }}{% endif %}" alt="img">
        <div class="mini-info">
            <h4><a href="{% url 'product_detail' item.slug %}" style="text-decoration:none; color:#333;">{{ item.name
                    }}</a></h4>
            <span>{{ item.price }} so'm</span>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block content %}
<div style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
    <div style="display: flex; gap: 40px; flex-wrap: wrap;">
        <!-- Image -->
        <div style="flex: 1; min-width: 300px;">
            {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}"
                style="width: 100%; border-radius: 12px; border: 1px solid #eee;">
            {% else %}
            <div
                style="width: 100%; height: 300px; background: #eee; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                Rasm mavjud emas</div>
            {% endif %}
        </div>

        <!-- Details -->
        <div style="flex: 1; min-width: 300px;">
            <h1 style="margin-top: 0; color: var(--primary-color);">{{ product.name }}</h1>
            <p style="color: #666; font-size: 0.9rem;">Kategoriya: <strong>{{ product.category.name }}</strong></p>
            <h2 style="color: #000; font-size: 2.2rem; margin: 15px 0;">{{ product.price }} so'm</h2>

            <div style="margin: 20px 0; line-height: 1.6;">
                <p>{{ product.description }}</p>
            </div>

            <form action="{% url 'cart_add' product.id %}" method="post">
                {% csrf_token %}
                <button type="submit"
                    style="width: 100%; background: var(--secondary-color); color: white; padding: 18px; font-size: 1.2rem; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; box-shadow: 0 4px 10px rgba(2, 119, 189, 0.3);">
                    Savatga qo'shish
                </button>
            </form>

            <p style="margin-top: 15px; color: green; font-size: 0.9rem;">âœ… Omborda mavjud ({{ product.stock }} dona)
            </p>
        </div>
    </div>
</div>

<!-- Related Products -->
<h3 style="margin-top: 40px; color: var(--secondary-color); border-bottom: 2px solid #eee; padding-bottom: 10px;">
    O'xshash Mahsulotlar</h3>
<div class="product-grid">
    {% for related in related_products %}
    <div class="product-card" onclick="location.href='{% url 'product_detail' related.slug %}'"
        style="cursor: pointer;">
        <div class="card-img-wrapper">
            {% if related.image %}
            <img src="{{ related.image.url }}" alt="{{ related.name }}" class="card-img">
            {% else %}
            <div style="color: #ccc;">Rasm yo'q</div>
            {% endif %}
        </div>
        <div class="card-category">{{ related.category.name }}</div>
        <h3 class="card-title">{{ related.name }}</h3>
        <div class="card-price">{{ related.price }} so'm</div>
    </div>
    {% empty %}
    <p>O'xshash mahsulotlar topilmadi.</p>
    {% endfor %}
</div>

{% endblock %}